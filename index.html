<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Sakai</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.80.1/phaser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
<div id="mainDialogueBox">
    <img src="assets/images/portrait/02.png">
    <p id="mainDialogueText"></p>
</div>
<div id ="secondaryDialogueBox">
    <img id="secondaryPortrait" src="assets/images/portrait/01.png">
    <p id="secondaryDialogueText"></p>
</div>
<div id ="secondaryDialogueBox">
    <p id="secondaryDialogueText"></p>
</div>
<div id ="secondaryDialogueBox">
    <p id="secondaryDialogueText"></p>
</div>
<div id ="secondaryDialogueBox">
    <p id="secondaryDialogueText"></p>
</div>
<div id="fightDialogueBox1">
    <p id="fightDialogueText1"></p>
</div>
<div id="fightDialogueBox2">
    <p id="fightDialogueText2"></p>
</div>
<div id="fightDialogueBoxMain">
    <p id="fightDialogueTextMain">STOP ! ARRETEZ VOUS ET VENEZ VOIR !</p>
</div>
<div id ="questBox">
    <div id="questBoxContent">
        <p id="questText"></p>
    </div>
</div>
<div id="fullScreenButton">
    <img id="fullScreenImage" src="assets/images/other/start.png" onclick="openFullscreen()">
</div>
<script type="text/javascript">

    const height = 1080
    const width = 1920

    var config = {
        type: Phaser.AUTO,
        width: width,
        height: height,
        physics: {
            default: 'arcade',
        },
        pixelArt: true,
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);

    const dialoguesKazekage = [
        "Salut Kazekage",
        "Salut Maitre Sakai, va chercher tes neuilles de frères on doit parler",
        "A propos de quoi chef ?",
        "A propos de feur, c'est très important, je t'attends ici.",
        "Ok ca marche je vais les chercher",
        "Qu'est ce que tu fais encore ici ? Va les chercher !",
    ];

    const dialoguesBot1 = [
        "X ? Mais qu'est ce que tu fais ici ? C'est pas dans tes habitudes de trainer dans les librairies",
        "Je savais que je te trouverais ici X, va vite devant le palais, le Kazekage nous attend !",
        "Le Kazekage ?! Mais pourquoi ? X a encore fait une bêtise ?",
        "Non, je crois que c'est à propos de notre dernière mission, il veut nous parler. Va au palais, je vais chercher les autres et je te rejoins.",
        "Ok, je vous attends devant le palais.",
    ];

    const dialoguesBot2et3 = [
        "X quest-ce que tu veux encore, on était entrain de s'entrainer !",
        "J'allais le détruire et me faire 10 000 Ryos sans forcer, pourquoi tu viens tout gâcher ?", 
        "Vous ferez ça plus tard, là le Kazekage nous attend pour parler de notre dernière mission, allez devant le palais, je vous rejoins.",
        "Le Kazekage ? Serieux ?",
        "Je sais pas trop si je suis excité ou terrifié... Allez X on y va rapidement !",
    ];

    const dialoguesBot3 = [
    ];

    const dialoguesBot4 = [
        "Ohhhh ! SaluUUuuT X !",
        "Serieusement, regarde dans quel êtat tu t'es encore mis, on fait que de te répéter d'arrêter de boire !",
        "DésOlééééé MAaaaAis le sAKé de la tAaverne est tEllEmEnt bOn !",
        "Allez avale ça, ça devrait te remettre sur pied, ca vient de la serre Kusamaru.",
        "*GLOUP...*",
        "Accélère, on doit rejoindre les autres devant le palais, le Kazekage nous attends.",
        "Quoi j'ai encore fait une connerie ? J'en ai marre...",
        "Non pour une fois c'est pas pour ça, va devant le palais, je te rejoins.",
        "Hmmmm... Ok !",
    ]

    const dialogueFightBot2 = [
        "J'espère que t'es prêt, j'vais te choquer",
        "Tu vas voir ce que je vais te faire !",
        "Si t'es si sur de toi, le gagnant prend 10 000 ryos !",
    ]

    const dialogueFightBot3 = [
        "Essaye déjà de me toucher !",
        "Je vais te montrer de quoi je suis capable !",
        "Je te suis, 10 000 ryos pour le gagnant !",
    ]

    const quests = [
        "Parler au Kazekage",
        "Trouver les autres frères Sakai (0/4)",
        "Trouver les autres frères Sakai (1/4)",
        "Trouver les autres frères Sakai (2/4)",
        "Trouver les autres frères Sakai (3/4)",
        "Trouver les autres frères Sakai (4/4)",
        "Retourner voir le Kazekage"
    ]

    const introDialogue = [
        "C'est la première fois que je rentre dans ce bureau... C'est impressionnant !",
        "Le Kazekage m\'a convoqué mais je ne sais pas vraiment à quel sujet...",
        "Allez Kikuo ! Pas de bégaiement et présente toi au Kazekage !"
    ]


    let lieu = "palais"
    let introDialogPage = 0;
    let dialogPage = 0;
    let dialogBot1Page = 0;
    let dialogBot2et3Page = 0;
    let dialogBot4Page = 0;
    let isFightDialogStarted = false;
    let FieldDialogue = 'waiting';
    let frere2 = null;
    let frere3 = null;
    let frere1 = null;
    let frere4 = null;
    let inDialogue = true;
    let freresCompleted = [
        false,
        false,
        false,
        false
    ]
    let freres = []
    let lastAnimation = null;

    function preload ()
    {
        this.load.image('bg1', 'assets/images/backgrounds/bg1.png');
        this.load.image('bg2', 'assets/images/backgrounds/bg2.png');
        this.load.image('bg3', 'assets/images/backgrounds/bg3.png');
        this.load.image('bg4', 'assets/images/backgrounds/bg4.png');
        this.load.image('bg5', 'assets/images/backgrounds/bg5.png');
        this.load.image('batiments', 'assets/images/backgrounds/batiments.png');
        this.load.image('statue', 'assets/images/backgrounds/statue.png');
        this.load.image('piedstatue', 'assets/images/backgrounds/piedstatue.png');
        this.load.image('barrieres', 'assets/images/backgrounds/barrieres.png');

        this.load.audio('startSound', 'assets/sounds/effects/start.mp3');
        this.load.audio('dialogueSound', 'assets/sounds/effects/dialogue.mp3');
        this.load.audio('kazekageOst', 'assets/sounds/ost/kazekage.mp3');
        this.load.audio('themeOst', 'assets/sounds/ost/theme.mp3');

        this.load.spritesheet('bot1',
            'assets/images/characters/bot1.png',
            { frameWidth: 91, frameHeight: 158 }
        );
        this.load.spritesheet('walkSide1', 'assets/images/characters/walkSide/002.png', {
            frameWidth: 29,
            frameHeight: 32
        });
        this.load.spritesheet('walkUp1', 'assets/images/characters/walkUp/002.png', {
            frameWidth: 34,
            frameHeight: 32
        });
        this.load.spritesheet('walkDown1', 'assets/images/characters/walkDown/002.png', {
            frameWidth: 34,
            frameHeight: 32
        });

        this.load.spritesheet('bot2',
            'assets/images/characters/bot2.png',
            { frameWidth: 91, frameHeight: 158 }
        );
        this.load.spritesheet('walkSide2', 'assets/images/characters/walkSide/003.png', {
            frameWidth: 29,
            frameHeight: 32
        });
        this.load.spritesheet('walkUp2', 'assets/images/characters/walkUp/003.png', {
            frameWidth: 34,
            frameHeight: 32
        });
        this.load.spritesheet('walkDown2', 'assets/images/characters/walkDown/003.png', {
            frameWidth: 34,
            frameHeight: 32
        });

        this.load.spritesheet('bot3',
            'assets/images/characters/bot3.png',
            { frameWidth: 91, frameHeight: 158 }
        );
        this.load.spritesheet('walkSide3', 'assets/images/characters/walkSide/004.png', {
            frameWidth: 29,
            frameHeight: 32
        });
        this.load.spritesheet('walkUp3', 'assets/images/characters/walkUp/004.png', {
            frameWidth: 34,
            frameHeight: 32
        });
        this.load.spritesheet('walkDown3', 'assets/images/characters/walkDown/004.png', {
            frameWidth: 34,
            frameHeight: 32
        });

        this.load.spritesheet('bot4',
            'assets/images/characters/joueur.png',
            { frameWidth: 91, frameHeight: 158 }
        );
        this.load.spritesheet('walkSide4', 'assets/images/characters/walkSide/005.png', {
            frameWidth: 29,
            frameHeight: 32
        });
        this.load.spritesheet('walkUp4', 'assets/images/characters/walkUp/005.png', {
            frameWidth: 34,
            frameHeight: 32
        });
        this.load.spritesheet('walkDown4', 'assets/images/characters/walkDown/005.png', {
            frameWidth: 34,
            frameHeight: 32
        });

        this.load.spritesheet('bot5',
            'assets/images/characters/walkDown/001.png',
            { frameWidth: 91, frameHeight: 158 }
        );
        this.load.spritesheet('walkSide5', 'assets/images/characters/walkSide/001.png', {
            frameWidth: 29,
            frameHeight: 32
        });
        this.load.spritesheet('walkUp5', 'assets/images/characters/walkUp/001.png', {
            frameWidth: 34,
            frameHeight: 32
        });
        this.load.spritesheet('walkDown5', 'assets/images/characters/walkDown/001.png', {
            frameWidth: 34,
            frameHeight: 32
        });
    }

    function create ()
    {
        this.input.on('pointerdown', function (pointer) {
            console.log('Coordonnées du clic: x=' + pointer.x + ' y=' + pointer.y);
        });
        this.cameras.main.setBackgroundColor('#21181b');

        this.startSound = this.sound.add('startSound');
        this.dialogueSound = this.sound.add('dialogueSound');

        var fullScreenButton = document.getElementById('fullScreenButton');

        fullScreenButton.addEventListener('click', () => {
            this.sound.play('startSound', { delay: 0, volume: 3});
        });

        this.player = this.physics.add.sprite(width/2-10, height-250, 'walkUp1');
        this.player.setScale(3.55)
        this.anims.create({
            key: 'walkSide1',
            frames: this.anims.generateFrameNumbers('walkSide1', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });
        this.anims.create({
            key: 'walkUp1',
            frames: this.anims.generateFrameNumbers('walkUp1', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.anims.create({
            key: 'walkDown1',
            frames: this.anims.generateFrameNumbers('walkDown1', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });

        this.anims.create({
            key: 'walkSide2',
            frames: this.anims.generateFrameNumbers('walkSide2', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });
        this.anims.create({
            key: 'walkUp2',
            frames: this.anims.generateFrameNumbers('walkUp2', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.anims.create({
            key: 'walkDown2',
            frames: this.anims.generateFrameNumbers('walkDown2', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
    
        this.frere3 = this.physics.add.sprite(770, 270, 'walkDown3');
        this.frere3.setDepth(-1);
        this.frere3.setScale(3.55);
        this.anims.create({
            key: 'walkSide3',
            frames: this.anims.generateFrameNumbers('walkSide3', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });
        this.anims.create({
            key: 'walkUp3',
            frames: this.anims.generateFrameNumbers('walkUp3', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.anims.create({
            key: 'walkDown3',
            frames: this.anims.generateFrameNumbers('walkDown3', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.frere3.disableBody(true, true);

        this.frere4 = this.physics.add.sprite(770, 270, 'walkDown4');
        this.frere4.setDepth(-1);
        this.frere4.setScale(3.55);
        this.anims.create({
            key: 'walkSide4',
            frames: this.anims.generateFrameNumbers('walkSide4', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });
        this.anims.create({
            key: 'walkUp4',
            frames: this.anims.generateFrameNumbers('walkUp4', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.anims.create({
            key: 'walkDown4',
            frames: this.anims.generateFrameNumbers('walkDown4', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.anims.create({
            key: 'walkSide5',
            frames: this.anims.generateFrameNumbers('walkSide5', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });
        this.anims.create({
            key: 'walkUp5',
            frames: this.anims.generateFrameNumbers('walkUp5', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.anims.create({
            key: 'walkDown5',
            frames: this.anims.generateFrameNumbers('walkDown5', { start: 0, end: 5 }),
            frameRate: 8,
            repeat: -1
        });
        this.frere4.disableBody(true, true);

        this.bg1 = this.add.image(width/2, height/2, 'bg1').setDepth(-6);
        this.bg1.displayHeight = height;
        this.bg1.setOrigin(0.5, 0.5);
        this.bg1.displayWidth = height;
        this.bg2 = this.add.image(width/2, height/2, 'bg2').setDepth(-7).setVisible(false);
        this.bg2.displayHeight = height;
        this.bg2.setOrigin(0.5, 0.5);
        this.bg2.displayWidth = width;
        this.bg3 = this.add.image(width/2, height/2, 'bg3').setDepth(-7).setVisible(false);
        this.bg3.displayHeight = height;
        this.bg3.setOrigin(0.5, 0.5);
        this.bg3.displayWidth = height;
        this.bg4 = this.add.image(width/2, height/2, 'bg4').setDepth(-7).setVisible(false);
        this.bg4.displayHeight = height;
        this.bg4.setOrigin(0.5, 0.5);
        this.bg4.displayWidth = width;
        this.bg5 = this.add.image(width/2, height/2, 'bg5').setDepth(-7).setVisible(false);
        this.bg5.displayHeight = height;
        this.bg5.setOrigin(0.5, 0.5);
        this.bg5.displayWidth = width;

        writeQuestText(quests[0], 'questText');

        this.player.setVelocity(0);

        // ********************************************************* CREATE BUREAU DU KAZEKAGE *********************************************************

        this.bureauPart1 = this.physics.add.sprite(945, 330);
        this.bureauPart2 = this.physics.add.sprite(800, 280);
        this.bureauPart3 = this.physics.add.sprite(1090, 280);
        this.physics.world.enable(this.bureauPart1);
        this.physics.world.enable(this.bureauPart2);
        this.physics.world.enable(this.bureauPart3);
        this.physics.add.collider(this.player, this.bureauPart1)
        this.physics.add.collider(this.player, this.bureauPart2)
        this.physics.add.collider(this.player, this.bureauPart3)
        this.bureauPart1.body.setImmovable(true);
        this.bureauPart2.body.setImmovable(true);
        this.bureauPart3.body.setImmovable(true);
        this.bureauPart1.setDisplaySize(200, 60);
        this.bureauPart2.setDisplaySize(30, 100);
        this.bureauPart3.setDisplaySize(30, 100);

        this.topWall = this.physics.add.sprite(560, 150);
        this.physics.world.enable(this.topWall);
        this.topWall.body.setImmovable(true);
        this.topWall.setDisplaySize(2000, 10);
        this.physics.add.collider(this.player, this.topWall);

        this.chess = this.physics.add.sprite(650, 620);
        this.physics.world.enable(this.chess);
        this.chess.body.setImmovable(true);
        this.chess.setDisplaySize(10, 10);
        this.physics.add.collider(this.player, this.chess);

        this.kazekageLeftLibrary = this.physics.add.sprite(490, 600);
        this.physics.world.enable(this.kazekageLeftLibrary);
        this.kazekageLeftLibrary.body.setImmovable(true);
        this.kazekageLeftLibrary.setDisplaySize(70, 750);
        this.physics.add.collider(this.player, this.kazekageLeftLibrary);

        this.kazekageRightLibrary = this.physics.add.sprite(1400, 600);
        this.physics.world.enable(this.kazekageRightLibrary);
        this.kazekageRightLibrary.body.setImmovable(true);
        this.kazekageRightLibrary.setDisplaySize(70, 750);
        this.physics.add.collider(this.player, this.kazekageRightLibrary);

        this.kazekageBottomWall = this.physics.add.sprite(710, 1025);
        this.physics.world.enable(this.kazekageBottomWall);
        this.kazekageBottomWall.body.setImmovable(true);
        this.kazekageBottomWall.setDisplaySize(200, 10);
        this.physics.add.collider(this.player, this.kazekageBottomWall);

        this.kazekageBottomWall2 = this.physics.add.sprite(1190, 1025);
        this.physics.world.enable(this.kazekageBottomWall2);
        this.kazekageBottomWall2.body.setImmovable(true);
        this.kazekageBottomWall2.setDisplaySize(200, 10);
        this.physics.add.collider(this.player, this.kazekageBottomWall2);

        const kazekageOfficeHitboxes = [
            this.bureauPart1,
            this.bureauPart2,
            this.bureauPart3,
            this.topWall,
            this.chess,
            this.kazekageLeftLibrary,
            this.kazekageRightLibrary
        ]


        // ********************************************************* CREATE BOTS *********************************************************

        this.bot1 = this.physics.add.sprite(1150, 180, 'bot1');
        this.bot1.setCollideWorldBounds(true);
        this.bot1.setImmovable(true);
        this.physics.add.collider(this.player, this.bot1);

        this.bot2 = this.physics.add.sprite(90, 330, 'bot2');
        this.bot2.setCollideWorldBounds(true);
        this.physics.add.collider(this.player, this.bot2);

        this.bot3 = this.physics.add.sprite(1800, 330, 'bot3');
        this.bot3.setCollideWorldBounds(true);
        this.physics.add.collider(this.player, this.bot3);

        this.bot4 = this.physics.add.sprite(300, 680, 'bot4');
        this.bot4.setCollideWorldBounds(true);
        this.bot4.setImmovable(true);
        this.physics.add.collider(this.player, this.bot4);


        // ********************************************************* CREATE LIBRAIRIE DE SUNA *********************************************************

        this.bibliotheque1 = this.physics.add.sprite(200, 210, 'hit');
        this.bibliotheque1.setDisplaySize(30, 250);
        this.bibliotheque1.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque1);

        this.bibliotheque2 = this.physics.add.sprite(200, 600, 'hit');
        this.bibliotheque2.setDisplaySize(30, 250);
        this.bibliotheque2.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque2);

        this.bibliotheque3 = this.physics.add.sprite(400, 210, 'hit');
        this.bibliotheque3.setDisplaySize(30, 250);
        this.bibliotheque3.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque3);

        this.bibliotheque4 = this.physics.add.sprite(400, 600, 'hit');
        this.bibliotheque4.setDisplaySize(30, 250);
        this.bibliotheque4.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque4);

        this.bibliotheque5 = this.physics.add.sprite(600, 210, 'hit');
        this.bibliotheque5.setDisplaySize(30, 250);
        this.bibliotheque5.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque5);

        this.bibliotheque6 = this.physics.add.sprite(600, 600, 'hit');
        this.bibliotheque6.setDisplaySize(30, 250);
        this.bibliotheque6.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque6);

        this.bibliotheque7 = this.physics.add.sprite(800, 210, 'hit');
        this.bibliotheque7.setDisplaySize(30, 250);
        this.bibliotheque7.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque7);

        this.bibliotheque8 = this.physics.add.sprite(800, 600, 'hit');
        this.bibliotheque8.setDisplaySize(30, 250);
        this.bibliotheque8.setImmovable(true);
        this.physics.add.collider(this.player, this.bibliotheque8);

        this.topWallLibrairie = this.physics.add.sprite(0, 120, 'hit');
        this.topWallLibrairie.setDisplaySize(2000, 10);
        this.topWallLibrairie.setImmovable(true);
        this.physics.add.collider(this.player, this.topWallLibrairie);

        this.chairLibrary1 = this.physics.add.sprite(200, 400, 'hit');
        this.chairLibrary1.setDisplaySize(10, 10);
        this.chairLibrary1.setImmovable(true);
        this.physics.add.collider(this.player, this.chairLibrary1);

        this.chairsAndTable1 = this.physics.add.sprite(200, 330, 'hit');
        this.chairsAndTable1.setDisplaySize(300, 10);
        this.chairsAndTable1.setImmovable(true);
        this.physics.add.collider(this.player, this.chairsAndTable1);

        this.tableLibrary1 = this.physics.add.sprite(200, 700, 'hit');
        this.tableLibrary1.setDisplaySize(30, 30);
        this.tableLibrary1.setImmovable(true);
        this.physics.add.collider(this.player, this.tableLibrary1);

        this.chairsAndTable2 = this.physics.add.sprite(200, 770, 'hit');
        this.chairsAndTable2.setDisplaySize(300, 100);
        this.chairsAndTable2.setImmovable(true);
        this.physics.add.collider(this.player, this.chairsAndTable2);

        this.bottomWallLibrairie = this.physics.add.sprite(450, 800, 'hit');
        this.bottomWallLibrairie.setDisplaySize(2000, 10);
        this.bottomWallLibrairie.setImmovable(true);
        this.physics.add.collider(this.player, this.bottomWallLibrairie);

        this.leftWallLibrairie = this.physics.add.sprite(20, 0, 'hit');
        this.leftWallLibrairie.setDisplaySize(10, 1000);
        this.leftWallLibrairie.setImmovable(true);
        this.physics.add.collider(this.player, this.leftWallLibrairie);

        this.leftWallLibrairie2 = this.physics.add.sprite(20, 700, 'hit');
        this.leftWallLibrairie2.setDisplaySize(10, 300);
        this.leftWallLibrairie2.setImmovable(true);
        this.physics.add.collider(this.player, this.leftWallLibrairie2);

        this.frere1Hitbox = this.physics.add.sprite(770, 210, 'hit');
        this.frere1Hitbox.setDisplaySize(80, 80);
        this.frere1Hitbox.setImmovable(true);
        this.physics.add.collider(this.player, this.frere1Hitbox);

        this.leftWallLibrairieBack = this.physics.add.sprite(375, 0, 'hit');
        this.leftWallLibrairieBack.setDisplaySize(10, 5000);
        this.leftWallLibrairieBack.setImmovable(true);
        this.physics.add.collider(this.player, this.leftWallLibrairieBack);

        this.rightWallLibrairie = this.physics.add.sprite(1500, 0, 'hit');
        this.rightWallLibrairie.setDisplaySize(10, 5000);
        this.rightWallLibrairie.setImmovable(true);
        this.physics.add.collider(this.player, this.rightWallLibrairie)

        this.bibliotheque1.disableBody(true, true);
        this.bibliotheque2.disableBody(true, true);
        this.bibliotheque3.disableBody(true, true);
        this.bibliotheque4.disableBody(true, true);
        this.bibliotheque5.disableBody(true, true);
        this.bibliotheque6.disableBody(true, true);
        this.bibliotheque7.disableBody(true, true);
        this.bibliotheque8.disableBody(true, true);
        this.topWallLibrairie.disableBody(true, true);
        this.chairLibrary1.disableBody(true, true);
        this.chairsAndTable1.disableBody(true, true);
        this.tableLibrary1.disableBody(true, true);
        this.chairsAndTable2.disableBody(true, true);
        this.bottomWallLibrairie.disableBody(true, true);
        this.leftWallLibrairie.disableBody(true, true);
        this.leftWallLibrairie2.disableBody(true, true);
        this.frere1Hitbox.disableBody(true, true);
        this.leftWallLibrairieBack.disableBody(true, true);
        this.rightWallLibrairie.disableBody(true, true);


        // ********************************************************* CREATE PLACE DE SUNA *********************************************************

        this.statueHitbox = this.physics.add.sprite(940, 740, 'hit');
        this.statueHitbox.setDisplaySize(300, 100);
        this.statueHitbox.setImmovable(true);
        this.physics.add.collider(this.player, this.statueHitbox);

        this.hautGaucheMaison = this.physics.add.sprite(500, 200, 'hit');
        this.hautGaucheMaison.setDisplaySize(850, 300);
        this.hautGaucheMaison.setImmovable(true);
        this.hautGaucheMaison2 = this.physics.add.sprite(270, 450, 'hit');
        this.hautGaucheMaison2.setDisplaySize(500, 200);
        this.hautGaucheMaison2.setImmovable(true);
        this.hautGaucheMaison3 = this.physics.add.sprite(550, 300, 'hit');
        this.hautGaucheMaison3.setDisplaySize(400, 250);
        this.hautGaucheMaison3.setImmovable(true);
        this.physics.add.collider(this.player, this.hautGaucheMaison);
        this.physics.add.collider(this.player, this.hautGaucheMaison2);
        this.physics.add.collider(this.player, this.hautGaucheMaison3);

        this.doublePot = this.physics.add.sprite(275, 580, 'hit');
        this.doublePot.setDisplaySize(100, 50);
        this.doublePot.setImmovable(true);
        this.doublePot2 = this.physics.add.sprite(1675, 555, 'hit');
        this.doublePot2.setDisplaySize(100, 50);
        this.doublePot2.setImmovable(true);
        this.physics.add.collider(this.player, this.doublePot);
        this.physics.add.collider(this.player, this.doublePot2);

        this.hautDroiteMaison = this.physics.add.sprite(1550, 220, 'hit');
        this.hautDroiteMaison.setDisplaySize(750, 430);
        this.hautDroiteMaison.setImmovable(true);
        this.hautDroiteMaison2 = this.physics.add.sprite(1550, 385, 'hit');
        this.hautDroiteMaison2.setDisplaySize(500, 200);
        this.hautDroiteMaison2.setImmovable(true);
        this.hautDroiteMaison3 = this.physics.add.sprite(1830, 480, 'hit');
        this.hautDroiteMaison3.setDisplaySize(200, 100);
        this.hautDroiteMaison3.setImmovable(true);
        this.physics.add.collider(this.player, this.hautDroiteMaison);
        this.physics.add.collider(this.player, this.hautDroiteMaison2);
        this.physics.add.collider(this.player, this.hautDroiteMaison3);

        this.batiments = this.add.image(width/2, height/2, 'batiments').setDepth(10);
        this.batiments.displayHeight = height;
        this.batiments.setOrigin(0.5, 0.5);
        this.batiments.displayWidth = width;

        this.statue = this.add.image(width/2, height/2, 'statue').setDepth(10);
        this.statue.displayHeight = height;
        this.statue.setOrigin(0.5, 0.5);
        this.statue.displayWidth = width;

        this.piedstatue = this.add.image(width/2, height/2, 'piedstatue').setDepth(-2);
        this.piedstatue.displayHeight = height;
        this.piedstatue.setOrigin(0.5, 0.5);
        this.piedstatue.displayWidth = width;

        this.statueHitbox.disableBody(true, true);
        this.hautGaucheMaison.disableBody(true, true);
        this.hautGaucheMaison2.disableBody(true, true);
        this.hautGaucheMaison3.disableBody(true, true);
        this.doublePot.disableBody(true, true);
        this.doublePot2.disableBody(true, true);
        this.hautDroiteMaison.disableBody(true, true);
        this.hautDroiteMaison2.disableBody(true, true);
        this.hautDroiteMaison3.disableBody(true, true);
        this.batiments.setVisible(false);
        this.statue.setVisible(false);
        this.piedstatue.setVisible(false);


        // ********************************************************* CREATE TERRAIN DE SUNA *********************************************************

        this.barrieres = this.add.image(width/2, height/2, 'barrieres').setDepth(10);
        this.barrieres.displayHeight = height;
        this.barrieres.setOrigin(0.5, 0.5);
        this.barrieres.displayWidth = width;

        this.grillageTerrain1 = this.physics.add.sprite(385, 670);
        this.grillageTerrain1.setDisplaySize(920, 10);
        this.grillageTerrain1.setImmovable(true);
        this.physics.add.collider(this.player, this.grillageTerrain1);

        this.grillageTerrain2 = this.physics.add.sprite(1500, 670);
        this.grillageTerrain2.setDisplaySize(920, 10);
        this.grillageTerrain2.setImmovable(true);
        this.physics.add.collider(this.player, this.grillageTerrain2);

        this.barrieres.setVisible(false);
        this.grillageTerrain1.disableBody(true, true);
        this.grillageTerrain2.disableBody(true, true);


        // ********************************************************* CREATE RUE DE SUNA *********************************************************

    


        this.rue1 = this.physics.add.sprite(950, 60);
        this.rue1.setDisplaySize(1900, 130);
        this.rue1.setImmovable(true);
        this.physics.add.collider(this.player, this.rue1);

        this.rue2 = this.physics.add.sprite(980, 920);
        this.rue2.setDisplaySize(1900, 160);
        this.rue2.setImmovable(true);
        this.physics.add.collider(this.player, this.rue2);

        this.rue1.disableBody(true, true);
        this.rue2.disableBody(true, true);
        this.bot1.disableBody(true, true);
        this.bot2.disableBody(true, true);
        this.bot3.disableBody(true, true);
        this.bot4.disableBody(true, true);

        this.player.setCollideWorldBounds(true);

        this.cursors = this.input.keyboard.createCursorKeys();

        this.player.setCollideWorldBounds(true);

        this.cursors = this.input.keyboard.createCursorKeys();
    }

    function update ()
    {
        const seuilProximite = 300;
        const seuilProximitePorte = 100;

        this.player.setVelocity(0);

        if (this.input.keyboard.createCursorKeys().left.isDown && !inDialogue ) {
            this.player.setVelocityX(-700);
            this.player.anims.play('walkSide1', true);
            this.player.flipX = true;
            this.lastAnimation = 'left';
        } else if (this.input.keyboard.createCursorKeys().right.isDown && !inDialogue) {
            this.player.setVelocityX(700);
            this.player.anims.play('walkSide1', true);
            this.player.flipX = false;
            this.lastAnimation = 'right';
        } else if (this.input.keyboard.createCursorKeys().up.isDown && !inDialogue) {
            this.player.setVelocityY(-700);
            this.player.anims.play('walkUp1', true);
            this.lastAnimation = 'up';
        } else if (this.input.keyboard.createCursorKeys().down.isDown && !inDialogue) {
            this.player.setVelocityY(700);
            this.player.anims.play('walkDown1', true);
            this.lastAnimation = 'down';
        } else {
            this.player.anims.stop();
        }

        if (!this.cursors.right.isDown && this.lastAnimation == 'right') {
            this.player.setFrame(0);
        }
        if (!this.cursors.left.isDown && this.lastAnimation == 'left') {
            this.player.setFrame(0);
        }
        if (!this.cursors.up.isDown && this.lastAnimation == 'up') {
            this.player.setFrame(0);
        }
        if (!this.cursors.down.isDown && this.lastAnimation == 'down') {
            this.player.setFrame(0);
        }

        if (introDialogPage > 0 && introDialogPage <= introDialogue.length) {
            if (this.cursors.space.isDown && espaceRelache) {
                if (introDialogPage > 2) {
                    document.getElementById('mainDialogueBox').style.display = 'none';
                    document.getElementById('questBox').style.display = 'flex';
                    inDialogue = false;
                } else {
                    this.sound.play('dialogueSound', { delay: 0});
                    document.getElementById('mainDialogueText').innerText = "";
                    writeDialogueText(introDialogue[introDialogPage], 'mainDialogueText');
                    introDialogPage++;
                    espaceRelache = false;
                }
            }
        }


        // ========================================================= UPDATE BUREAU DU KAZEKAGE =========================================================

        const distanceKazekageCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 950, 440);
        const distancePorteKazekageCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 950, 1050);


        if (lieu == "palais") {
            document.getElementById('secondaryPortrait').src = 'assets/images/portrait/kazekage.png';
            if (distanceKazekageCoord < seuilProximite && this.cursors.space.isDown && espaceRelache) {
                document.getElementById('mainDialogueText').innerText = "";
                document.getElementById('secondaryDialogueText').innerText = "";
                if (dialogPage == 5 || (dialogPage >=5 && dialogPage%2 !== 0)) {
                    inDialogue = false;
                    document.getElementById('secondaryDialogueBox').style.display = 'none';
                    document.getElementById('mainDialogueBox').style.display = 'none';
                    dialogPage++;
                    espaceRelache = false;
                    if (dialogPage == 6) {
                        writeQuestText(quests[1]);
                    }
                } else if (dialogPage >= 5 && dialogPage%2 == 0) {
                    inDialogue = true;
                    let dialogueText = dialoguesKazekage[5];
                    writeDialogueText(dialogueText, 'secondaryDialogueText');
                    document.getElementById('secondaryDialogueBox').style.display = 'flex';
                    espaceRelache = false;
                    dialogPage++;
                    this.sound.play('dialogueSound', { delay: 0});
                } else {
                    inDialogue = true;
                    let dialogueText = dialoguesKazekage[dialogPage];
                    if (dialogPage%2 == 1) {
                        document.getElementById('secondaryDialogueBox').style.display = 'flex';
                        document.getElementById('mainDialogueBox').style.display = 'none';
                        writeDialogueText(dialogueText, 'secondaryDialogueText');
                    } else {
                        document.getElementById('mainDialogueBox').style.display = 'flex';
                        document.getElementById('secondaryDialogueBox').style.display = 'none';
                        writeDialogueText(dialogueText, 'mainDialogueText');
                    }
                    espaceRelache = false;
                    dialogPage++;
                    this.sound.play('dialogueSound', { delay: 0});
                }
            }

            // Direction Place
            if (distancePorteKazekageCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                this.bureauPart1.disableBody(true, true);
                this.bureauPart2.disableBody(true, true);
                this.bureauPart3.disableBody(true, true);
                this.topWall.disableBody(true, true);
                this.chess.disableBody(true, true);
                this.kazekageLeftLibrary.disableBody(true, true);
                this.kazekageRightLibrary.disableBody(true, true);
                this.kazekageBottomWall.disableBody(true, true);
                this.kazekageBottomWall2.disableBody(true, true);
                this.bg1.setVisible(false);
                this.bg2.setVisible(true);
                lieu = "place"
                espaceRelache = false;
                setTimeout(() => {
                    this.sound.stopByKey('kazekageOst');
                }, 1000);
                this.sound.play('themeOst', { delay: 0, volume: 0.05, loop: true});
            }
        }


        // ========================================================= UPDATE PLACE DE SUNA =========================================================

        const distancePorteLibrairieCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 1900, 590);
        const distancePorteRueCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 0, 630);
        const distancePortePalaisCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 470, 890);
        const distancePorteTerrainCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 1070, 0);

        if (lieu == "place") {
            // load batiment
            this.hautGaucheMaison.enableBody(true, 525, 200);
            this.hautGaucheMaison2.enableBody(true, 270, 420);
            this.hautGaucheMaison3.enableBody(true, 420, 290);
            this.doublePot.enableBody(true, 275, 540);
            this.doublePot2.enableBody(true, 1675, 510);
            this.hautDroiteMaison.enableBody(true, 1550, 220);
            this.hautDroiteMaison2.enableBody(true, 1850, 385);
            this.hautDroiteMaison3.enableBody(true, 1830, 480);
            this.batiments.setVisible(true);
            this.statue.setVisible(true);

            this.statueHitbox.enableBody(true, 940, 720, 'hit');
            itemsLoaded = true;

            // Direction Palais
            if (distancePortePalaisCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                disablePlaceItems();
                this.bureauPart1.enableBody(true, 435, 270);
                this.bureauPart2.enableBody(true, 320, 250);
                this.bureauPart3.enableBody(true, 560, 250);
                this.topWall.enableBody(true, 0, 120);
                this.chess.enableBody(true, 190, 520);
                this.kazekageLeftLibrary.enableBody(true, 50, 600);
                this.kazekageRightLibrary.enableBody(true, 840, 600);
                this.kazekageBottomWall.enableBody(true, 215, 860);
                this.kazekageBottomWall2.enableBody(true, 670, 860);
                this.bg2.setVisible(false);
                this.bg1.setVisible(true);
                lieu = "palais"
                espaceRelache = false;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index].disableBody(true, true);
                    }
                })
            }

            // Direction Librairie
            if (distancePorteLibrairieCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                disablePlaceItems();
                // move the player to the left side of the screen
                this.player.x = 450;
                this.player.y = 625;
                this.bg3.setVisible(true);
                this.bg2.setVisible(false);
                lieu = "librairie"
                espaceRelache = false;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index].disableBody(true, true);
                    }
                })
            }

            // Direction Rue
            if (distancePorteRueCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                // move the player to the right side of the screen
                disablePlaceItems();
                this.player.x = 1905;
                this.player.y = 560;
                this.bg5.setVisible(true);
                this.bg2.setVisible(false);
                lieu = "rue"
                espaceRelache = false;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index].disableBody(true, true);
                    }
                })
            }

            // Direction Terrain
            if (distancePorteTerrainCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                // move the player to the top side of the screen
                disablePlaceItems();
                this.player.y = 990;
                this.player.x = 1022;
                this.bg4.setVisible(true);
                this.bg2.setVisible(false);
                lieu = "terrain"
                espaceRelache = false;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index].disableBody(true, true);
                    }
                })
            }
        }

        if (!this.cursors.space.isDown) {
            espaceRelache = true;
        }


        // ========================================================= UPDATE LIBRAIRIE DE SUNA =========================================================

        const distancePortePlaceCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 450, 625);
        const distanceBot1Coord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 1365, 285);

        if (lieu == "librairie") {
            document.getElementById('secondaryPortrait').src = 'assets/images/portrait/03.png';
            if (!frere1 && !freresCompleted[0]) {
                frere1 = this.physics.add.sprite(1365, 285, 'walkSide2');
                frere1.setDepth(-1);
                this.frere1Hitbox.enableBody(true, 1365, 285);
                frere1.setScale(3.2);
            }
            this.player.setScale(3.2)

            this.bibliotheque1.enableBody(true, 875, 250);
            this.bibliotheque2.enableBody(true, 1060, 720);
            this.bibliotheque3.enableBody(true, 1060, 250);
            this.bibliotheque4.enableBody(true, 1250, 720);
            this.bibliotheque5.enableBody(true, 1250, 250);
            this.bibliotheque6.enableBody(true, 1440, 720);
            this.bibliotheque7.enableBody(true, 1440, 250);
            this.bibliotheque8.enableBody(true, 875, 720);
            this.topWallLibrairie.enableBody(true, 850, 160);
            this.chairLibrary1.enableBody(true, 655, 400);
            this.chairsAndTable1.enableBody(true, 650, 340);
            this.tableLibrary1.enableBody(true, 655, 760);
            this.chairsAndTable2.enableBody(true, 655, 820);
            this.bottomWallLibrairie.enableBody(true, 800, 1030);
            this.leftWallLibrairie.enableBody(true, 420, -50);
            this.leftWallLibrairie2.enableBody(true, 420, 865);
            this.leftWallLibrairieBack.enableBody(true, 375, 0);
            this.rightWallLibrairie.enableBody(true, 1520, 0);


            if (distanceBot1Coord < seuilProximite && this.cursors.space.isDown && espaceRelache) {
                document.getElementById('secondaryDialogueText').innerText = "";
                document.getElementById('mainDialogueText').innerText = "";
                if (dialogBot1Page >= 5) {
                    inDialogue = false;
                    document.getElementById('secondaryDialogueBox').style.display = 'none';
                    document.getElementById('mainDialogueBox').style.display = 'none';
                    this.frere1Hitbox.disableBody(true, true);
                    dialogBot1Page++;
                    espaceRelache = false;
                    if (!freresCompleted[0]) {
                        writeQuestText(quests[2]);
                        setTimeout(() => {
                            frere1.anims.play('walkDown2', true);
                            this.physics.moveTo(frere1, 1365, 520, 430);
                        }, 500);
                        setTimeout(() => {
                            frere1.body.stop();
                            frere1.anims.play('walkSide2', true);
                            frere1.flipX = true;
                            this.physics.moveTo(frere1, 300, 520, 430);
                            this.physics.world.removeCollider(this.frere1HitboxCollider);
                        }, 1000);
                        setTimeout(() => {
                            frere1.body.stop();
                            frere1.anims.play('walkSide2', true);
                            this.physics.moveTo(frere1, 425, 620, 430);
                        }, 2200);
                        setTimeout(() => {
                            frere1.body.stop();
                            frere1.anims.stop();
                            frere1.setFrame(0);
                            frere1.setVisible(false);
                            frere1.disableBody(true, true);
                        }, 3200);
                        freresCompleted[0] = true;
                    }
                } else {
                    inDialogue = true;
                    let dialogueText = dialoguesBot1[dialogBot1Page];
                    if (dialogBot1Page%2 == 0) {
                        document.getElementById('secondaryDialogueBox').style.display = 'flex';
                        document.getElementById('mainDialogueBox').style.display = 'none';
                        writeDialogueText(dialogueText, 'secondaryDialogueText');
                        this.sound.play('dialogueSound', { delay: 0});
                    } else {
                        document.getElementById('mainDialogueBox').style.display = 'flex';
                        document.getElementById('secondaryDialogueBox').style.display = 'none';
                        writeDialogueText(dialogueText, 'mainDialogueText');
                        this.sound.play('dialogueSound', { delay: 0});
                    }
                    espaceRelache = false;
                    dialogBot1Page++;
                }
            }


            // Direction Place
            if (distancePortePlaceCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                this.bibliotheque1.disableBody(true, true);
                this.bibliotheque2.disableBody(true, true);
                this.bibliotheque3.disableBody(true, true);
                this.bibliotheque4.disableBody(true, true);
                this.bibliotheque5.disableBody(true, true);
                this.bibliotheque6.disableBody(true, true);
                this.bibliotheque7.disableBody(true, true);
                this.bibliotheque8.disableBody(true, true);
                this.topWallLibrairie.disableBody(true, true);
                this.chairLibrary1.disableBody(true, true);
                this.chairsAndTable1.disableBody(true, true);
                this.tableLibrary1.disableBody(true, true);
                this.chairsAndTable2.disableBody(true, true);
                this.bottomWallLibrairie.disableBody(true, true);
                this.leftWallLibrairie.disableBody(true, true);
                this.leftWallLibrairie2.disableBody(true, true);
                this.frere1Hitbox.disableBody(true, true);
                this.leftWallLibrairieBack.disableBody(true, true);
                this.rightWallLibrairie.disableBody(true, true);

                if (frere1) {
                    frere1.disableBody(true, true);
                    frere1 = null;
                }
                
                this.player.x = 1850;
                this.player.y = 640;
                this.bg3.setVisible(false);
                this.bg2.setVisible(true);
                lieu = "place"

                let freresCount = 0;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index] = this.physics.add.sprite(985, 950 - (freresCount*55), 'bot'+(index+1));

                        freres[index].setDepth(20-index);
                        freresCount++;
                    }
                })

                espaceRelache = false;

            }
        }


        // ========================================================= UPDATE RUE DE SUNA =========================================================

        const distancePortePlaceRueCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 890, 580);
        const distanceBot4Coord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 300, 680);

        if (lieu == "rue") {
            if (!frere4 && !freresCompleted[3]) {
                frere4 = this.physics.add.sprite(300, 680, 'walkDown4');
                frere4.setScale(3.2);
            }

            if (distanceBot4Coord < seuilProximite && this.cursors.space.isDown && espaceRelache) {
                if (dialogBot4Page >= 9) {
                    document.getElementById('secondaryDialogueBox').style.display = 'none';
                    document.getElementById('mainDialogueBox').style.display = 'none';
                    dialogBot4Page++;
                    espaceRelache = false;
                    setTimeout(() => {
                        this.physics.moveTo(frere4, 1905, 500, 800);
                    }, 500);
                    setTimeout(() => {
                        frere4.body.stop();
                    }, 2800);
                    freresCompleted[3] = true;
            
                } else {
                    let dialogueText = dialoguesBot4[dialogBot4Page];
                    if (dialogBot4Page%2 == 0) {
                        document.getElementById('secondaryDialogueBox').style.display = 'flex';
                        document.getElementById('mainDialogueBox').style.display = 'none';
                        document.getElementById('secondaryDialogueText').innerText = dialogueText;
                    } else {
                        document.getElementById('mainDialogueBox').style.display = 'flex';
                        document.getElementById('secondaryDialogueBox').style.display = 'none';
                        document.getElementById('mainDialogueText').innerText = dialogueText;
                    }
                    espaceRelache = false;
                    dialogBot4Page++;
                }
            }

            // Direction Place
            if (distancePortePlaceRueCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                this.player.x = 0;
                this.player.y = 610;
                this.bg5.setVisible(false);
                this.bg2.setVisible(true);
                this.bot4.disableBody(true, true);
                lieu = "place"
                espaceRelache = false;

                let freresCount = 0;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index] = this.physics.add.sprite(985, 950 - (freresCount*55), 'bot'+(index+1));

                        freres[index].setDepth(20-index);
                        freresCount++;
                    }
                })
            }
        }


        // ========================================================= UPDATE TERRAIN DE SUNA =========================================================

        const distancePortePlaceTerrainCoord = Phaser.Math.Distance.Between(this.player.x, this.player.y, 1020, 1060);

        if (lieu == "terrain") {
            if (!frere2 && !freresCompleted[1]) {
                frere2 = this.physics.add.sprite(90, 550, 'walkSide5');
                frere2.setScale(3.55);
                frere2.setDepth(-1);
            }

            if (!frere3 && !freresCompleted[2]) {
                frere3 = this.physics.add.sprite(1830, 550, 'walkSide3');
                frere3.setScale(3.55);
                frere3.flipX = true;
                frere3.setDepth(-1);

            }
            this.grillageTerrain1.enableBody(true, 480, 890);
            this.grillageTerrain1.setVisible(true);
            this.grillageTerrain2.enableBody(true, 1575, 890);
            this.grillageTerrain2.setVisible(true);
            this.barrieres.setVisible(true);

            if (!isFightDialogStarted) {
                setTimeout(() => updateFightDialogue1(0), 500);
                setTimeout(() => updateFightDialogue2(0), 2500);
                isFightDialogStarted = true;
            }

            if (this.player.y <= 625 && dialogBot2et3Page <= 5) {
                this.player.setVelocity(0, 0);
                if (FieldDialogue == 'waiting') {
                    document.getElementById('fightDialogueBoxMain').style.display = 'flex';
                    FieldDialogue = 'started';
                    setTimeout(() => {
                        document.getElementById('fightDialogueText1').innerText = '???';
                        document.getElementById('fightDialogueText2').innerText = '???';
                    }, 500)
                    setTimeout(() => {
                        frere2.anims.play('walkSide5', true);
                        frere3.anims.play('walkSide3', true);
                        this.physics.moveTo(frere2, this.player.x - 20, this.player.y - 100, 800);
                        this.physics.moveTo(frere3, this.player.x + 20, this.player.y - 100, 800);
                        document.getElementById('fightDialogueBox1').style.display = 'none';
                        document.getElementById('fightDialogueBoxMain').style.display = 'none';
                        document.getElementById('fightDialogueBox2').style.display = 'none';
                    }, 1500);
                    setTimeout(() => {
                        document.getElementById('secondaryPortrait').src = 'assets/images/portrait/01.png';
                        document.getElementById('secondaryDialogueBox').style.display = 'flex';
                        writeDialogueText(dialoguesBot2et3[dialogBot2et3Page], 'secondaryDialogueText');
                        dialogBot2et3Page++;
                        FieldDialogue = 'ended';
                    }, 2500);

                }

                if (Phaser.Math.Distance.Between(frere2.x, frere2.y, this.player.x - 20, this.player.y - 100) < 50) {
                    frere2.anims.play('walkDown5', true);
                    frere2.body.stop();
                    frere2.setFrame(0);

                }
                if (Phaser.Math.Distance.Between(frere3.x, frere3.y, this.player.x + 20, this.player.y - 100) < 50) {
                    frere3.anims.play('walkDown3', true);
                    frere3.body.stop();
                    frere3.setFrame(0);
                }

                if (FieldDialogue == 'ended' && this.cursors.space.isDown && espaceRelache) {
                    if (dialogBot2et3Page >= 5) {
                        document.getElementById('secondaryDialogueBox').style.display = 'none';
                        document.getElementById('mainDialogueBox').style.display = 'none';
                        dialogBot2et3Page++;
                        espaceRelache = false;
                        this.player.setVelocity(1000, 1000);

                        setTimeout(() => {
                            this.physics.moveTo(frere2,  875, 633, 800);
                        }, 500);
                        setTimeout(() => {
                            this.physics.moveTo(frere3, 875, 550, 800);
                        }, 800);
                        setTimeout(() => {
                            frere2.body.stop();
                            this.physics.moveTo(frere2, 1030, 750, 800);
                        }, 600);
                        setTimeout(() => {
                            frere3.body.stop();
                            this.physics.moveTo(frere3, 1030, 750, 800);
                        }, 1100);
                        setTimeout(() => {
                            frere2.body.stop();
                            this.physics.moveTo(frere2, 1030, 1080, 800);
                        }, 800);
                        setTimeout(() => {
                            frere3.body.stop();
                            this.physics.moveTo(frere3, 1030, 1080, 800);
                        }, 1300);
                        setTimeout(() => {
                            frere3.body.stop();
                            frere2.body.stop();
                        }, 2500);
                        freresCompleted[1] = true;
                        freresCompleted[2] = true;
                    } else {
                        let dialogueText = dialoguesBot2et3[dialogBot2et3Page];
                        if (dialogBot2et3Page%3 == 0) {
                            document.getElementById('secondaryPortrait').src = 'assets/images/portrait/01.png';
                            document.getElementById('secondaryDialogueBox').style.display = 'flex';
                            document.getElementById('mainDialogueBox').style.display = 'none';
                            writeDialogueText(dialogueText, 'secondaryDialogueText');
                        } else if (dialogBot2et3Page%3 == 1) {
                            document.getElementById('secondaryPortrait').src = 'assets/images/portrait/04.png';
                            writeDialogueText(dialogueText, 'secondaryDialogueText');
                        } else if (dialogBot2et3Page%3 == 2) {
                            document.getElementById('mainDialogueBox').style.display = 'flex';
                            document.getElementById('secondaryDialogueBox').style.display = 'none';
                            writeDialogueText(dialogueText, 'mainDialogueText');
                        }
                        espaceRelache = false;
                        dialogBot2et3Page++;
                    }
                }
            }


            // Direction Place
            if (distancePortePlaceTerrainCoord < seuilProximitePorte && this.cursors.space.isDown && espaceRelache) {
                this.player.x = 1070;
                this.player.y = 5;
                this.grillageTerrain1.disableBody(true, true);
                this.grillageTerrain2.disableBody(true, true);
                this.bg4.setVisible(false);
                this.bg2.setVisible(true);
                this.bot2.disableBody(true, true);
                this.bot3.disableBody(true, true);
                this.barrieres.setVisible(false);
                if (frere2) {
                    frere2.disableBody(true, true);
                    frere2 = null;
                }
                if (frere3) {
                    frere3.disableBody(true, true);
                    frere3 = null;
                }
                lieu = "place"
                espaceRelache = false;
                let freresCount = 0;
                freresCompleted.forEach((completed, index) => {
                    if (completed) {
                        freres[index] = this.physics.add.sprite(985, 950 - (freresCount*55), 'bot'+(index+1));

                        freres[index].setDepth(20-index);
                        freresCount++;
                    }
                })
            }
        }
    }

    function updateFightDialogue1(index) {
        if (FieldDialogue == "ended") {
            return
        }
        if (index < dialogueFightBot2.length) {
            document.getElementById('fightDialogueBox1').style.display = 'flex';
            document.getElementById('fightDialogueText1').innerText = dialogueFightBot2[index];
        }
        if (index < dialogueFightBot2.length || index < dialogueFightBot3.length) {
            setTimeout(() => updateFightDialogue1(index + 1), 4000);
        }
        if (index == dialogueFightBot2.length) {
            setTimeout(() => {
                document.getElementById('fightDialogueBox1').style.display = 'none';
            }, 2000);
        }
    }

    function updateFightDialogue2(index) {
        if (FieldDialogue == "ended") {
            return
        }
        if (index < dialogueFightBot2.length) {
            document.getElementById('fightDialogueBox2').style.display = 'flex';
            document.getElementById('fightDialogueText2').innerText = dialogueFightBot3[index];
        }
        if (index < dialogueFightBot2.length || index < dialogueFightBot3.length) {
            setTimeout(() => updateFightDialogue2(index + 1), 4000);
        }
        if (index == dialogueFightBot2.length) {
            setTimeout(() => {
                document.getElementById('fightDialogueBox2').style.display = 'none';
            }, 2000);
        }
    }

    function writeDialogueText(text, elementSelector, speed=10) {
        document.getElementById('mainDialogueText').innerText = "";
        document.getElementById('secondaryDialogueText').innerText = "";
        const element = document.querySelector("#"+elementSelector);
        if (element) {
            new TypeIt(element, {
                strings: text,
                speed: speed,
                waitUntilVisible: true,
                cursor: false,
            }).go();
        } else {
            console.error('Element not found:', elementSelector);
        }
    }

    function writeQuestText(text) {
        document.getElementById('questText').innerText = "";
        const element = document.querySelector("#questText");
        if (element) {
            new TypeIt(element, {
                strings: text,
                speed: 50,
                waitUntilVisible: true,
                cursor: false,
            }).go();
        } else {
            console.error('Element not found:', elementSelector);
        }
    }
    
    function  openFullscreen() {
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
        } else if (document.documentElement.mozRequestFullScreen) { /* Firefox */
            document.documentElement.mozRequestFullScreen();
        } else if (document.documentElement.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
            document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) { /* IE/Edge */
            document.documentElement.msRequestFullscreen();
        }
        // display none on the button
        document.getElementById('fullScreenButton').classList.add('hidden');
        document.getElementById('fullScreenImage').classList.add('hidden');
        setTimeout(() => {
            writeDialogueText(introDialogue[0], 'mainDialogueText', 30);
            let scene = game.scene.getScene('default');
            scene.sound.play("kazekageOst", { volume: 0.1, loop: true });
        }, 2000);
        introDialogPage++;
    }

    function disablePlaceItems() {
        let scene = game.scene.getScene('default');
        scene.hautGaucheMaison.disableBody(true, true);
        scene.hautGaucheMaison2.disableBody(true, true);
        scene.hautGaucheMaison3.disableBody(true, true);
        scene.doublePot.disableBody(true, true);
        scene.doublePot2.disableBody(true, true);
        scene.hautDroiteMaison.disableBody(true, true);
        scene.hautDroiteMaison2.disableBody(true, true);
        scene.hautDroiteMaison3.disableBody(true, true);
        scene.batiments.setVisible(false);
        scene.statue.setVisible(false);
        scene.statueHitbox.disableBody(true, true);
    }



</script>

</body>
</html>